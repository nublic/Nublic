#!/bin/bash
# 1. Randomize password of postgres autogenerated user
export password=`</dev/urandom tr -dc A-Za-z1-9'\!".$%&/()=?|@#[]-_.:,;' | head -c12`
cat > /etc/nublic/resource.conf <<EOF
#!/bin/bash
export NUBLIC_RESOURCE_USER="nublic_resource"
export NUBLIC_RESOURCE_PASS='$password'
EOF
chmod a-rwx /etc/nublic/resource.conf
chmod u+rw /etc/nublic/resource.conf

# sudo passwd postgres
# 2. Access to PostgreSQL command line
# 3. Create the new super user for Resource with all the permissions
# 4. Create the database for Resource
# NOTICE that creating a database takes about 30s.
sudo -u postgres psql <<EOF
CREATE USER nublic_resource WITH 
      SUPERUSER
      PASSWORD '$password';
CREATE DATABASE nublic_resource WITH OWNER nublic_resource
    ENCODING 'UTF8';
EOF
# Similar in the shell is: createuser -s -P -U usuario nublic_resource
