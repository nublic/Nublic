#!/bin/sh

id -g nublic
GROUP_EXISTS=$?
id nublic
USER_EXISTS=$?

if [ ${GROUP_EXISTS} -ne 0 ]
then
    addgroup nublic <<EOF
EOF
fi

if [ ${USER_EXISTS} -ne 0 ]
then
    # Randomize password of autogenerated user
    export password=`</dev/urandom tr -dc A-Za-z1-9'-!' | head -c22`
    cat > /etc/nublic/user.conf <<EOF
NUBLIC_USER_PASS='$password'
EOF
    adduser --no-create-home --ingroup nublic nublic <<EOF
${password}
${password}





y
EOF
fi

for dir in cache fs log "data/nublic-only" "data/mirrors" "data/synced"
do
    CURRENT_DIR=/var/nublic/${dir}
    mkdir -p ${CURRENT_DIR}
    chmod 777 ${CURRENT_DIR}
    chown nublic ${CURRENT_DIR}
    chgrp nublic ${CURRENT_DIR}
done
